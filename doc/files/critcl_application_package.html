<!DOCTYPE html><html><head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>critcl_application_package - C Runtime In Tcl (CriTcl)</title>
<style type="text/css"><!--
    HTML {
	background: 	#FFFFFF;
	color: 		black;
    }
    BODY {
	background: 	#FFFFFF;
	color:	 	black;
    }
    DIV.doctools {
	margin-left:	10%;
	margin-right:	10%;
    }
    DIV.doctools H1,DIV.doctools H2 {
	margin-left:	-5%;
    }
    H1, H2, H3, H4 {
	margin-top: 	1em;
	font-family:	sans-serif;
	font-size:	large;
	color:		#005A9C;
	background: 	transparent;
	text-align:		left;
    }
    H1.doctools_title {
	text-align: center;
    }
    UL,OL {
	margin-right: 0em;
	margin-top: 3pt;
	margin-bottom: 3pt;
    }
    UL LI {
	list-style: disc;
    }
    OL LI {
	list-style: decimal;
    }
    DT {
	padding-top: 	1ex;
    }
    UL.doctools_toc,UL.doctools_toc UL, UL.doctools_toc UL UL {
	font:		normal 12pt/14pt sans-serif;
	list-style:	none;
    }
    LI.doctools_section, LI.doctools_subsection {
	list-style: 	none;
	margin-left: 	0em;
	text-indent:	0em;
	padding: 	0em;
    }
    PRE {
	display: 	block;
	font-family:	monospace;
	white-space:	pre;
	margin:		0%;
	padding-top:	0.5ex;
	padding-bottom:	0.5ex;
	padding-left:	1ex;
	padding-right:	1ex;
	width:		100%;
    }
    PRE.doctools_example {
	color: 		black;
	background: 	#f5dcb3;
	border:		1px solid black;
    }
    UL.doctools_requirements LI, UL.doctools_syntax LI {
	list-style: 	none;
	margin-left: 	0em;
	text-indent:	0em;
	padding:	0em;
    }
    DIV.doctools_synopsis {
	color: 		black;
	background: 	#80ffff;
	border:		1px solid black;
	font-family:	serif;
	margin-top: 	1em;
	margin-bottom: 	1em;
    }
    UL.doctools_syntax {
	margin-top: 	1em;
	border-top:	1px solid black;
    }
    UL.doctools_requirements {
	margin-bottom: 	1em;
	border-bottom:	1px solid black;
    }
--></style>
</head>
<!-- Generated from file 'critcl_application_package.man' by tcllib/doctools with format 'html'
   -->
<!-- Copyright &amp;copy; Jean-Claude Wippler   -- Copyright &amp;copy; Steve Landers   -- Copyright &amp;copy; 2011-2024 Andreas Kupries
   -->
<!-- critcl_application_package.n
   -->
<body><hr> [
   <a href="../toc.html">Table Of Contents</a>
&#124; <a href="../index.html">Keyword Index</a>
 ] <hr>
<div class="doctools">
<h1 class="doctools_title">critcl_application_package(n) 3.3.1 doc &quot;C Runtime In Tcl (CriTcl)&quot;</h1>
<div id="name" class="doctools_section"><h2><a name="name">Name</a></h2>
<p>critcl_application_package - CriTcl Application Package Reference</p>
</div>
<div id="toc" class="doctools_section"><h2><a name="toc">Table Of Contents</a></h2>
<ul class="doctools_toc">
<li class="doctools_section"><a href="#toc">Table Of Contents</a></li>
<li class="doctools_section"><a href="#synopsis">Synopsis</a></li>
<li class="doctools_section"><a href="#section1">Description</a></li>
<li class="doctools_section"><a href="#section2">API</a></li>
<li class="doctools_section"><a href="#section3">Options</a></li>
<li class="doctools_section"><a href="#section4">Modes Of Operation/Use</a></li>
<li class="doctools_section"><a href="#section5">Package Structure</a></li>
<li class="doctools_section"><a href="#section6">Authors</a></li>
<li class="doctools_section"><a href="#section7">Bugs, Ideas, Feedback</a></li>
<li class="doctools_section"><a href="#keywords">Keywords</a></li>
<li class="doctools_section"><a href="#category">Category</a></li>
<li class="doctools_section"><a href="#copyright">Copyright</a></li>
</ul>
</div>
<div id="synopsis" class="doctools_section"><h2><a name="synopsis">Synopsis</a></h2>
<div class="doctools_synopsis">
<ul class="doctools_requirements">
<li>package require <b class="pkgname">Tcl 8.6</b></li>
<li>package require <b class="pkgname">critcl::app <span class="opt">?3.3.1?</span></b></li>
<li>package require <b class="pkgname">critcl <span class="opt">?3.3.1?</span></b></li>
<li>package require <b class="pkgname">platform <span class="opt">?1.0.2?</span></b></li>
<li>package require <b class="pkgname">cmdline</b></li>
</ul>
<ul class="doctools_syntax">
<li><a href="#1"><b class="cmd">::critcl::app::main</b> <i class="arg">commandline</i></a></li>
</ul>
</div>
</div>
<div id="section1" class="doctools_section"><h2><a name="section1">Description</a></h2>
<p>Be welcome to the <i class="term">C Runtime In Tcl</i> (short: <i class="term"><a href="critcl.html">CriTcl</a></i>), a system for embedding and using C
code from within <a href="http://core.tcl-lang.org/tcl">Tcl</a> scripts.</p>
<p>This document is the reference manpage for the <b class="package">critcl::app</b>
package. Its intended audience are developers working on critcl's
internals.  
These commands are not needed to simply write a <i class="term">CriTcl script</i>.
	If you are in need of an overview of the whole system instead, please
	go and read the <i class="term"><a href="critcl.html">Introduction To CriTcl</a></i>.</p>
<p>This package resides in the Application Layer of CriTcl.</p>
<p><img alt="arch_application" src="../image/arch_application.png"></p>
<p>,
implementing the functionality of the <i class="term">CriTcl Application</i>,
and through this, the mode <span class="sectref"><a href="#section4">generate package</a></span>.
The actual application is (only) a shim wrapping around this
package. It itself is build on top of the core package
<b class="package"><a href="critcl.html">critcl</a></b>.</p>
</div>
<div id="section2" class="doctools_section"><h2><a name="section2">API</a></h2>
<p>The package exports a single command</p>
<dl class="doctools_definitions">
<dt><a name="1"><b class="cmd">::critcl::app::main</b> <i class="arg">commandline</i></a></dt>
<dd><p>The <i class="arg">commandline</i> is a list of zero or more options followed by zero or
more <i class="term">CriTcl script</i> files.  By default, the <i class="term">CriTcl script</i> files
are build and the results cached.   This cuts down on the time needed to
load the package.  The last occurrence of <b class="option">-pkg</b> and <b class="option">-tea</b>, if
provided, selects the corresponding alternative mode of operations.
For a larger set of examples please see section &quot;Building CriTcl Packages&quot;
in the document about <i class="term">Using CriTcl</i>.</p></dd>
</dl>
<p>The options are:</p>
</div>
<div id="section3" class="doctools_section"><h2><a name="section3">Options</a></h2>
<p>The following options are understood:</p>
<dl class="doctools_options">
<dt><b class="option">-v</b></dt>
<dd></dd>
<dt><b class="option">--version</b></dt>
<dd><p>Print the version to <b class="const">stdout</b> and exit.</p></dd>
<dt><b class="option">-I</b> path</dt>
<dd><p>Arranges for the compiler to search <i class="arg">path</i> for headers.
Uses of this option are cumulative.</p>
<p>Ignored when generating a TEA package
(see option <b class="option">-tea</b> below).</p></dd>
<dt><b class="option">-L</b> path</dt>
<dd><p>Arranges for the linker to search <i class="arg">path</i>.
Uses of this option are cumulative.</p>
<p>Ignored when generating a TEA package
(see option <b class="option">-tea</b> below).</p></dd>
<dt><b class="option">-cache</b> path</dt>
<dd><p>Sets <i class="arg">path</i> as the directory to use as the result cache. The default is
&quot;<b class="file">~/.critcl/&lt;platform&gt;</b>&quot;, or &quot;<b class="file">~/.critcl/&lt;pid&gt;.&lt;epoch&gt;</b>&quot; when generating
a package.  See option <b class="option">-pkg</b>, below.</p>
<p>Ignored when generating a TEA package
(see option <b class="option">-tea</b> below).</p></dd>
<dt><b class="option">-clean</b></dt>
<dd><p>Arranges for all files and directories in the result cache to be deleted before
compilation begins.</p>
<p>Ignored when generating a package because this mode starts out with a
unique and empty result cache.  See option <b class="option">-pkg</b>, below.</p>
<p>Ignored when generating a TEA package
(see option <b class="option">-tea</b> below).</p></dd>
<dt><b class="option">-config</b> path</dt>
<dd><p>Provides a custom configuration file.  By default a configuration included in
the system core is used.
When specified multiple times the last value is used.</p>
<p>Ignored when generating a TEA package
(see option <b class="option">-tea</b> below).</p></dd>
<dt><b class="option">-debug</b> mode</dt>
<dd><p>Activates one of the following debugging modes:</p>
<dl class="doctools_definitions">
<dt><b class="const">memory</b></dt>
<dd><p>Track and report memory allocations made by the Tcl core.</p></dd>
<dt><b class="const">symbols</b></dt>
<dd><p>Compile all &quot;<b class="file">.c</b>&quot; files with debugging symbols.</p></dd>
<dt><b class="const">all</b></dt>
<dd><p>Both <b class="const">memory</b> and <b class="const">symbols</b>.</p></dd>
</dl>
<p>Ignored when generating a TEA package
(see option <b class="option">-tea</b> below).
Uses of this option are cumulative.</p></dd>
<dt><b class="option">-disable</b> name</dt>
<dd><p>Sets the value of the custom build configuration option
<i class="arg">name</i> to <b class="const">false</b>. It is equivalent to &quot;-with-<i class="arg">name</i> 0&quot;.</p>
<p>Validated only if one of the input files for the <i class="term">CriTcl script</i>
actually defines and uses a custom build configuration option with that
<i class="arg">name</i>.</p>
<p>Ignored when generating a TEA package
(see option <b class="option">-tea</b> below).</p></dd>
<dt><b class="option">-enable</b> name</dt>
<dd><p>Sets the value of the custom build configuration option
<i class="arg">name</i> to <b class="const">true</b>. It is equivalent to &quot;-with-<i class="arg">name</i> 1&quot;.</p>
<p>Validated only if one of the input files for the <i class="term">CriTcl script</i>
actually defines and uses a custom build configuration option with that
<i class="arg">name</i>.</p>
<p>Ignored when generating a TEA package
(see option <b class="option">-tea</b> below).</p></dd>
<dt><b class="option">-force</b></dt>
<dd><p>Forces compilation even if a shared library for the file already exists.
Unlike cleaning the cache, this is lazy in the destruction of files and only
affects relevant files.</p>
<p>Ignored when generating a package (see option <b class="option">-pkg</b>, below),
which starts out with a unique and empty result cache.</p>
<p>Ignored when generating a TEA package
(see option <b class="option">-tea</b> below).</p></dd>
<dt><b class="option">-help</b></dt>
<dd><p>Prints a short description of command line syntax and options and then exits
the application.</p></dd>
<dt><b class="option">-keep</b></dt>
<dd><p>Causes the system to cache compiled &quot;<b class="file">.c</b>&quot; files.
Also prevents the deletion of the unique result cache used by the run when
generating a package (see option <b class="option">-pkg</b> below),
Intended for debugging of <b class="cmd"><a href="critcl.html">critcl</a></b> itself, where it may be necessary to
inspect the generated C code.</p>
<p>Ignored when generating a TEA package
(see option <b class="option">-tea</b> below).</p></dd>
<dt><b class="option">-libdir</b> directory</dt>
<dd><p>Adds <i class="arg">directory</i> to the list of directories the linker searches for
libraries in (like <b class="option">-L</b>).  With <b class="option">-pkg</b>, generated packages are
saved in <i class="arg">directory</i>.
When specified multiple times the last value is used.
The default is &quot;<b class="file">lib</b>&quot;, resolved relative to the current working directory.</p></dd>
<dt><b class="option">-includedir</b> directory</dt>
<dd><p>Adds <i class="arg">directory</i> to the list of directories the compiler searches for
headers in. With <b class="option">-pkg</b>, generated header files are saved in
<i class="arg">directory</i>.
Uses of this option are cumulative.
The last value is used as the destination for generated header files.
The default is the relative directory &quot;<b class="file">include</b>&quot;, resolved relative to the
current working directory.</p>
<p>Ignored when generating a TEA package
(see option <b class="option">-tea</b> below).</p></dd>
<dt><b class="option">-pkg</b></dt>
<dd><p>Generates a package from the <i class="term">CriTcl script</i> files.  Input files are
processed first as usual, but are then bundled into a single library, with
additional generated files to form the library into a standard Tcl package.</p>
<p>generation. If both options, i.e. <b class="option">-pkg</b> and <b class="option">-tea</b> are
specified the last one specified wins.</p>
<p>Options <b class="option">-clean</b> and <b class="option">-force</b> are ignored. <b class="option">-libdir</b> is
relevant in both this and <b class="option">-tea</b> mode.</p>
<p>The basename of the first file is the name of the package to generate. If
its file extension indicates a shared library (&quot;<b class="file">.so</b>&quot;, &quot;<b class="file">.sl</b>&quot;,
&quot;<b class="file">.dylib</b>&quot;, and &quot;<b class="file">.dll</b>&quot;) it is also removed from the set of input
files. Each <i class="term">CriTcl script</i> file is kept as part of the input. A single
file without a suffix is assumed to be a <i class="term">CriTcl script</i>. A file without
a suffix, but other input files following is treated like the name of a
shared library proper, and removed from the set of input files.</p>
<p>Examples:</p>
<pre class="doctools_example">
	... -pkg ... foo
	=&gt; Package name is: foo
	=&gt; Input file is:   foo.tcl
</pre>
<pre class="doctools_example">
	... -pkg ... foo bar.tcl
	=&gt; Package name is: foo
	=&gt; Input file is:   bar.tcl
</pre>
<pre class="doctools_example">
	... -pkg ... foo.tcl
	=&gt; Package name is: foo
	=&gt; Input file is:   foo.tcl
</pre>
<pre class="doctools_example">
	... -pkg ... foo.so bar.tcl
	=&gt; Package name is: foo
	=&gt; Input file is:   bar.tcl
</pre>
</dd>
<dt><b class="option">-show</b></dt>
<dd><p>Prints the configuration of the chosen target to <b class="const">stdout</b> and then exits.
Set <b class="option">-target</b>, below.</p></dd>
<dt><b class="option">-showall</b></dt>
<dd><p>Prints the whole chosen configuration file to <b class="const">stdout</b> and then exits.
See <b class="option">-config</b>, above.</p></dd>
<dt><b class="option">-target</b> name</dt>
<dd><p>Overrides the default choice of build target.
Only the last occurrence of this option is used.
The named target must exist in the chosen configuration file.
Use <b class="option">-targets</b> (see below) to get a list of the
acceptable targets.
Use <b class="option">-config</b> to select the configuration file.</p>
<p>Ignored when generating a TEA package
(see option <b class="option">-tea</b> below).</p></dd>
<dt><b class="option">-targets</b></dt>
<dd><p>Prints the list of all known targets from the chosen configuration file to
<b class="const">stdout</b> and then exits.
Use <b class="option">-config</b> to select the configuration file.</p></dd>
<dt><b class="option">-tea</b></dt>
<dd><p>Like <b class="option">-pkg</b>, except no binaries are generated. Creates a directory
hierarchy containing the <i class="term">CriTcl script</i>, its companion files, and a
TEA-conformant build system with most of the needed support code, including
copies of the critcl packages.</p>
<p>If both <b class="option">-pkg</b> and <b class="option">-tea</b> are specified the last occurrence wins.</p>
<p><b class="option">-I</b>, <b class="option">-L</b>, <b class="option">-clean</b>,
<b class="option">-force</b>, <b class="option">-cache</b>, <b class="option">-includedir</b>, <b class="option">-enable</b>,
<b class="option">-disable</b>, and <b class="option">-with-<b class="variable">FOO</b></b> are
ignored. In contrast, the option <b class="option">-libdir</b> is relevant in both
this and <b class="option">-pkg</b> mode.</p>
<p>The basename of the first file is the name of the package to generate. If
its file extension indicates a shared library (&quot;<b class="file">.so</b>&quot;, &quot;<b class="file">.sl</b>&quot;,
&quot;<b class="file">.dylib</b>&quot;, and &quot;<b class="file">.dll</b>&quot;) it is also removed from the set of input
files. Each <i class="term">CriTcl script</i> file is kept as part of the input. A single
file without a suffix is assumed to be a <i class="term">CriTcl script</i>. A file without
a suffix, but other input files following is treated like the name of a
shared library proper, and removed from the set of input files.</p>
<p>Examples:</p>
<pre class="doctools_example">
	... -tea ... foo
	=&gt; Package name is: foo
	=&gt; Input file is:   foo.tcl
</pre>
<pre class="doctools_example">
	... -tea ... foo bar.tcl
	=&gt; Package name is: foo
	=&gt; Input file is:   bar.tcl
</pre>
<pre class="doctools_example">
	... -tea ... foo.tcl
	=&gt; Package name is: foo
	=&gt; Input file is:   foo.tcl
</pre>
<pre class="doctools_example">
	... -tea ... foo.so bar.tcl
	=&gt; Package name is: foo
	=&gt; Input file is:   bar.tcl
</pre>
</dd>
<dt><b class="option">-with-<b class="variable">name</b></b> value</dt>
<dd><p>This option sets the value of the custom build configuration option
<i class="arg">name</i> to <i class="arg">value</i>.</p>
<p>The information is validated only if one of the &quot;<b class="file">.critcl</b>&quot;
input files actually defines and uses a custom build configuration
option with that <i class="arg">name</i>.</p>
<p>Ignored when generating a TEA package
(see option <b class="option">-tea</b> below).</p></dd>
</dl>
</div>
<div id="section4" class="doctools_section"><h2><a name="section4">Modes Of Operation/Use</a></h2>
<p>CriTcl can be used in three different modes of operation, called</p>
<ol class="doctools_enumerated">
<li><p><i class="term"><a href="../index.html#compile_run">Compile &amp; Run</a></i>, and</p></li>
<li><p><i class="term"><a href="../index.html#generate_package">Generate Package</a></i></p></li>
<li><p><i class="term">Generate TEA Package</i></p></li>
</ol>
<p><i class="term"><a href="../index.html#compile_run">Compile &amp; Run</a></i> was the original mode and is the default for
<i class="term">critcl_pkg</i>.  Collects the C fragments from the
<i class="term">CriTcl script</i>, builds them as needed, and caches the results to
improve load times later.</p>
<p>The second mode, <i class="term"><a href="../index.html#generate_package">Generate Package</a></i>, was introduced to enable
the creation of (prebuilt) deliverable packages which do not depend on
the existence of a build system, i.e. C compiler, on the target
machine.
This was originally done through the experimental <b class="cmd">Critbind</b> tool,
and is now handled by the <i class="term">CriTcl Application</i>, also named
<b class="cmd"><a href="critcl.html">critcl</a></b>.</p>
<p>Newly introduced with CriTcl version 3 is
<i class="term">Generate TEA Package</i>. This mode constructs a directory
hierarchy from the package which can later be built like a regular TEA
package, i.e. using</p>
<pre class="doctools_example">
	.../configure --prefix ...
	make all isntall
</pre>
</div>
<div id="section5" class="doctools_section"><h2><a name="section5">Package Structure</a></h2>
<p>Packages generated by critcl have the following basic structure:</p>
<pre class="doctools_example">
&lt;TOP&gt;
+- pkgIndex.tcl
+- critcl-rt.tcl
+- license.terms (optional)
|
+- tcl (optional)
|  +- &lt;tsources files&gt;
|
+- &lt;platform&gt;
   +- &lt;shared library&gt;
</pre>
<p><em>Notes</em></p>
<ol class="doctools_enumerated">
<li><p>The file &quot;<b class="file">pkgIndex.tcl</b>&quot; is the standard package index file
expected by Tcl's package management. It is sourced during a search
for packages, and declares the package to Tcl with its files, and how
to handle them.</p></li>
<li><p>The file &quot;<b class="file">critcl-rt.tcl</b>&quot; is a helper file containing the
common code used by &quot;<b class="file">pkgIndex.tcl</b>&quot; to perform its tasks.</p></li>
<li><p>The file &quot;<b class="file">license.terms</b>&quot; is optional and appears only if
the &quot;<b class="file">.critcl</b>&quot; file the package is generated from used the command
<b class="cmd">critcl::license</b> to declare package author and license.</p></li>
<li><p>All files declared with the command <b class="cmd">critcl::tsources</b> are
put into the sub-directory &quot;<b class="file">tcl</b>&quot;.</p></li>
<li><p>The shared library generated by critcl is put into a
platform-specific sub-directory.</p></li>
</ol>
<p>The whole structure, and especially the last point, enable us
to later merge the results (for the same package, and version) for
multiple target platforms into a single directory structure without
conflict, by simply copying the top directories over each other. The
only files which can conflict are in the &lt;TOP&gt; and &quot;<b class="file">tcl</b>&quot;
directories, and for these we know that they are identical across
targets. The result of such a merge would look like:</p>
<pre class="doctools_example">
&lt;TOP&gt;
+- pkgIndex.tcl
+- critcl-rt.tcl
+- license.terms (optional)
|
+- tcl (optional)
|  +- &lt;tsources files&gt;
|
+- &lt;platform1&gt;
|  +- &lt;shared library1&gt;
+- &lt;platform2&gt;
|  +- &lt;shared library2&gt;
...
+- &lt;platformN&gt;
   +- &lt;shared libraryN&gt;
</pre>
</div>
<div id="section6" class="doctools_section"><h2><a name="section6">Authors</a></h2>
<p>Jean Claude Wippler, Steve Landers, Andreas Kupries</p>
</div>
<div id="section7" class="doctools_section"><h2><a name="section7">Bugs, Ideas, Feedback</a></h2>
<p>This document, and the package it describes, will undoubtedly contain
bugs and other problems.
Please report them at <a href="https://github.com/andreas-kupries/critcl/issues">https://github.com/andreas-kupries/critcl/issues</a>.
Ideas for enhancements you may have for either package, application,
and/or the documentation are also very welcome and should be reported
at <a href="https://github.com/andreas-kupries/critcl/issues">https://github.com/andreas-kupries/critcl/issues</a> as well.</p>
</div>
<div id="keywords" class="doctools_section"><h2><a name="keywords">Keywords</a></h2>
<p><a href="../index.html#c_code">C code</a>, <a href="../index.html#embedded_c_code">Embedded C Code</a>, <a href="../index.html#calling_c_code_from_tcl">calling C code from Tcl</a>, <a href="../index.html#code_generator">code generator</a>, <a href="../index.html#compile_run">compile &amp; run</a>, <a href="../index.html#compiler">compiler</a>, <a href="../index.html#dynamic_code_generation">dynamic code generation</a>, <a href="../index.html#dynamic_compilation">dynamic compilation</a>, <a href="../index.html#generate_package">generate package</a>, <a href="../index.html#linker">linker</a>, <a href="../index.html#on_demand_compilation">on demand compilation</a>, <a href="../index.html#on_the_fly_compilation">on-the-fly compilation</a></p>
</div>
<div id="category" class="doctools_section"><h2><a name="category">Category</a></h2>
<p>Glueing/Embedded C code</p>
</div>
<div id="copyright" class="doctools_section"><h2><a name="copyright">Copyright</a></h2>
<p>Copyright &copy; Jean-Claude Wippler<br>
Copyright &copy; Steve Landers<br>
Copyright &copy; 2011-2024 Andreas Kupries</p>
</div>
</div></body></html>
